---
layout: default
title: 架構概覽
---

<div class="doc-layout">
    <aside class="doc-sidebar">
        <nav class="sidebar-nav">
            <h4 class="sidebar-title">本頁目錄</h4>
            <ul class="sidebar-links">
                <li><a href="#overview" class="sidebar-link">系統總覽</a></li>
                <li><a href="#soc-variants" class="sidebar-link">晶片變體</a></li>
                <li><a href="#memory-layout" class="sidebar-link">記憶體配置</a></li>
                <li><a href="#build-pipeline" class="sidebar-link">建構流程</a></li>
                <li><a href="#components" class="sidebar-link">元件架構</a></li>
                <li><a href="#configuration" class="sidebar-link">配置系統</a></li>
                <li><a href="#app-structure" class="sidebar-link">應用程式結構</a></li>
                <li><a href="#directory" class="sidebar-link">目錄結構</a></li>
                <li><a href="#ble-stack" class="sidebar-link">BLE 棧架構</a></li>
                <li><a href="#bsp" class="sidebar-link">BSP 與驅動</a></li>
            </ul>
        </nav>
    </aside>

    <article class="doc-content">
        <h1>架構概覽</h1>
        <p>IPRO SDK 採用清晰的分層架構設計，提供高度模組化與可移植性，讓開發者能夠快速建構穩定的嵌入式應用。本頁詳細介紹 SDK 的系統架構、晶片規格、建構流程與元件組成。</p>

        <!-- Section 1: System Overview -->
        <section id="overview">
            <h2>系統總覽</h2>
            <p>SDK 的整體架構由五個主要層次組成，從上至下分別為應用層、元件層、RTOS 層、BSP 層與硬體層：</p>

            <div class="architecture-layers">
                <div class="layer layer-green">
                    <div class="layer-label">Applications (apps/)</div>
                    <div class="layer-items">
                        <span class="pill">bluetooth/</span>
                        <span class="pill">matter/</span>
                        <span class="pill">ipro7_demo</span>
                        <span class="pill">ipro_unit_test</span>
                    </div>
                </div>
                <div class="layer layer-cyan">
                    <div class="layer-label">Components (components/)</div>
                    <div class="layer-items">
                        <span class="pill">BLE 5.4</span>
                        <span class="pill">Matter</span>
                        <span class="pill">WiFi 6</span>
                        <span class="pill">Thread</span>
                        <span class="pill">Zigbee</span>
                        <span class="pill">802.15.4</span>
                        <span class="pill">lwIP</span>
                        <span class="pill">mbedTLS</span>
                        <span class="pill">CherryUSB</span>
                        <span class="pill">Audio</span>
                        <span class="pill">AI/NPU</span>
                        <span class="pill">Codec</span>
                        <span class="pill">LittleFS</span>
                        <span class="pill">FatFS</span>
                        <span class="pill">Shell</span>
                        <span class="pill">Agora</span>
                        <span class="pill">Opus</span>
                        <span class="pill">LC3</span>
                    </div>
                </div>
                <div class="layer layer-purple">
                    <div class="layer-label">RTOS (FreeRTOS / Zephyr)</div>
                    <div class="layer-items">
                        <span class="pill">FreeRTOS POSIX</span>
                        <span class="pill">OSAL</span>
                        <span class="pill">Zephyr Kernel</span>
                    </div>
                </div>
                <div class="layer layer-amber">
                    <div class="layer-label">BSP (bsp/)</div>
                    <div class="layer-items">
                        <span class="pill">HAL</span>
                        <span class="pill">Drivers</span>
                        <span class="pill">Board Config</span>
                        <span class="pill">Linker Scripts</span>
                        <span class="pill">Startup</span>
                    </div>
                </div>
                <div class="layer layer-red">
                    <div class="layer-label">Hardware (IPRO7 / IPRO6)</div>
                    <div class="layer-items">
                        <span class="pill">RISC-V RV32IMAFC</span>
                        <span class="pill">Cortex-M0+</span>
                        <span class="pill">BLE Radio</span>
                        <span class="pill">NPU</span>
                    </div>
                </div>
            </div>

            <p>每一層都有明確的職責邊界：</p>
            <ul>
                <li><strong>應用層</strong>：自包含的專案，每個專案擁有獨立的 <code>.config</code> 和 <code>CMakeLists.txt</code></li>
                <li><strong>元件層</strong>：可重用的中間件，透過 Kconfig 選項啟用或停用</li>
                <li><strong>RTOS 層</strong>：提供任務排程、同步原語與計時器服務</li>
                <li><strong>BSP 層</strong>：硬體抽象層與驅動程式，屏蔽不同晶片的差異</li>
                <li><strong>硬體層</strong>：IPRO 系列 SoC 平台</li>
            </ul>
        </section>

        <!-- Section 2: SoC Variants -->
        <section id="soc-variants">
            <h2>晶片變體</h2>
            <p>IPRO SDK 支援多款晶片，涵蓋高效能物聯網到超低功耗場景：</p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>晶片</th>
                            <th>核心架構</th>
                            <th>主頻</th>
                            <th>Flash</th>
                            <th>RAM</th>
                            <th>特殊功能</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>IPRO7</strong></td>
                            <td>RISC-V RV32IMAFC</td>
                            <td>192 MHz</td>
                            <td>4 MB</td>
                            <td>16 MB PSRAM + 256 KB OCRAM</td>
                            <td>BLE 5.4, WiFi 6, 0.1 TOPS NPU, ISP</td>
                        </tr>
                        <tr>
                            <td><strong>IPRO6</strong></td>
                            <td>RISC-V</td>
                            <td>-</td>
                            <td>-</td>
                            <td>-</td>
                            <td>前代 SoC，BLE + WiFi</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="alert alert-info">
                <strong>提示：</strong>IPRO7 為目前主力開發平台，SDK 中大部分範例與文件皆以 IPRO7 為主。透過 Kconfig 中的 <code>CONFIG_IPRO7=y</code> 或 <code>CONFIG_IPRO6=y</code> 選擇目標晶片。
            </div>
        </section>

        <!-- Section 3: Memory Layout -->
        <section id="memory-layout">
            <h2>記憶體配置（IPRO7）</h2>
            <p>IPRO7 的記憶體空間分為四個主要區域，各有不同的存取特性與用途：</p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>區域</th>
                            <th>大小</th>
                            <th>起始位址</th>
                            <th>存取特性</th>
                            <th>用途</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Flash</strong></td>
                            <td>1 MB</td>
                            <td><code>0x13000000</code></td>
                            <td>XIP 可執行</td>
                            <td>程式碼與唯讀資料儲存</td>
                        </tr>
                        <tr>
                            <td><strong>PSRAM</strong></td>
                            <td>8 MB</td>
                            <td><code>0x1e000000</code></td>
                            <td>隨機存取</td>
                            <td>主要 RAM（堆積、資料段、大型緩衝區）</td>
                        </tr>
                        <tr>
                            <td><strong>OCRAM</strong></td>
                            <td>256 KB</td>
                            <td><code>0x11010000</code></td>
                            <td>高速 SRAM</td>
                            <td>堆疊、中斷處理、效能關鍵程式碼</td>
                        </tr>
                        <tr>
                            <td><strong>HBNRAM</strong></td>
                            <td>4 KB</td>
                            <td><code>0x20090000</code></td>
                            <td>休眠保持</td>
                            <td>深度休眠期間保留的關鍵資料</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="architecture-layers">
                <div class="layer layer-blue">
                    <div class="layer-label">Flash (1 MB) — 0x13000000 ~ 0x130FFFFF</div>
                    <div class="layer-desc">程式碼 + 唯讀資料 (XIP 執行)</div>
                </div>
                <div class="layer layer-cyan">
                    <div class="layer-label">PSRAM (8 MB) — 0x1e000000 ~ 0x1e7FFFFF</div>
                    <div class="layer-desc">主要 RAM（堆積、.data、.bss）</div>
                </div>
                <div class="layer layer-amber">
                    <div class="layer-label">HBNRAM (4 KB) — 0x20090000 ~ 0x20090FFF</div>
                    <div class="layer-desc">休眠保持 RAM</div>
                </div>
                <div class="layer layer-green">
                    <div class="layer-label">OCRAM (256 KB) — 0x11010000 ~ 0x1104FFFF</div>
                    <div class="layer-desc">高速 SRAM（堆疊、關鍵路徑）</div>
                </div>
            </div>
        </section>

        <!-- Section 4: Build Pipeline -->
        <section id="build-pipeline">
            <h2>建構流程</h2>
            <p>SDK 使用 <strong>Kconfig + CMake + Ninja</strong> 建構管線，從配置到最終二進位的流程如下：</p>

            <div class="flow-diagram">
                <div class="flow-step">
                    <div class="flow-number">1</div>
                    <div class="flow-title">.config</div>
                    <div class="flow-desc">Kconfig 設定檔</div>
                </div>
                <div class="flow-arrow"><i class="fas fa-arrow-right"></i></div>
                <div class="flow-step">
                    <div class="flow-number">2</div>
                    <div class="flow-title">CMake</div>
                    <div class="flow-desc">產生 autoconf.h</div>
                </div>
                <div class="flow-arrow"><i class="fas fa-arrow-right"></i></div>
                <div class="flow-step">
                    <div class="flow-number">3</div>
                    <div class="flow-title">Ninja</div>
                    <div class="flow-desc">編譯原始碼</div>
                </div>
                <div class="flow-arrow"><i class="fas fa-arrow-right"></i></div>
                <div class="flow-step">
                    <div class="flow-number">4</div>
                    <div class="flow-title">Link</div>
                    <div class="flow-desc">連結產生 ELF</div>
                </div>
                <div class="flow-arrow"><i class="fas fa-arrow-right"></i></div>
                <div class="flow-step">
                    <div class="flow-number">5</div>
                    <div class="flow-title">.bin</div>
                    <div class="flow-desc">韌體二進位檔</div>
                </div>
            </div>

            <h3>標準建構命令</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">FreeRTOS 建構（生產環境）</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash"># 方式一：使用 Make 包裝（推薦）
make -C apps/ipro7_demo

# 方式二：使用建構腳本
./build_freertos.sh ipro7_demo build

# 清除建構
make -C apps/ipro7_demo clean</code></pre>
            </div>

            <h3>工具鏈</h3>
            <p>SDK 使用 RISC-V 交叉編譯器，位於 <code>/opt/toolchain/riscv_ipro7/bin/</code>：</p>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>項目</th>
                            <th>值</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>編譯器前綴</td>
                            <td><code>riscv64-unknown-elf-</code></td>
                        </tr>
                        <tr>
                            <td>目標架構</td>
                            <td><code>rv32imafc</code> / <code>ilp32f</code></td>
                        </tr>
                        <tr>
                            <td>工具鏈偵測</td>
                            <td><code>cmake/toolchain.cmake</code> 自動偵測 vendor GCC（含 <code>_xxldsp</code> 擴充）與標準 GCC</td>
                        </tr>
                        <tr>
                            <td>建構輸出</td>
                            <td><code>apps/&lt;project&gt;/build/build_out/&lt;project&gt;_IPRO7.bin</code></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>Zephyr 建構（實驗性）</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">Zephyr 建構命令</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash"># 使用 SDK 提供的建構腳本
./tools/zephyr/build.sh -a &lt;app&gt; -b ipro7_fpga -c</code></pre>
            </div>

            <div class="alert alert-warning">
                <strong>注意：</strong>Zephyr 建構目前為實驗性質，生產環境請使用 FreeRTOS 建構。
            </div>
        </section>

        <!-- Section 5: Component Architecture -->
        <section id="components">
            <h2>元件架構</h2>
            <p><code>components/</code> 目錄包含所有可重用的中間件與函式庫，依功能分類如下：</p>

            <h3>無線通訊</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>元件</th>
                            <th>路徑</th>
                            <th>說明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Bluetooth LE 5.4</strong></td>
                            <td><code>wireless/bluetooth/</code></td>
                            <td>Zephyr BLE Host + RivieraWaves 控制器，含 70+ Profiles、LE Audio</td>
                        </tr>
                        <tr>
                            <td><strong>WiFi 6</strong></td>
                            <td><code>wireless/wifi6/</code></td>
                            <td>WiFi 6 (802.11ax) 協定棧</td>
                        </tr>
                        <tr>
                            <td><strong>Thread</strong></td>
                            <td><code>wireless/thread/</code></td>
                            <td>Thread 網狀網路協定</td>
                        </tr>
                        <tr>
                            <td><strong>Zigbee</strong></td>
                            <td><code>wireless/zigbee/</code></td>
                            <td>Zigbee 協定棧</td>
                        </tr>
                        <tr>
                            <td><strong>IEEE 802.15.4</strong></td>
                            <td><code>wireless/ieee802154/</code></td>
                            <td>802.15.4 MAC 層</td>
                        </tr>
                        <tr>
                            <td><strong>RF</strong></td>
                            <td><code>wireless/rf/</code></td>
                            <td>射頻底層驅動</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>網路與安全</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>元件</th>
                            <th>路徑</th>
                            <th>說明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>lwIP</strong></td>
                            <td><code>network/lwip/</code></td>
                            <td>輕量級 TCP/IP 協定棧（IPv4/IPv6）</td>
                        </tr>
                        <tr>
                            <td><strong>Mbed TLS</strong></td>
                            <td><code>crypto/mbedtls/</code></td>
                            <td>TLS/SSL 加密通訊</td>
                        </tr>
                        <tr>
                            <td><strong>Cipher Suite</strong></td>
                            <td><code>crypto/cipher_suite/</code></td>
                            <td>密碼學工具套件</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>作業系統</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>元件</th>
                            <th>路徑</th>
                            <th>說明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>FreeRTOS</strong></td>
                            <td><code>os/freertos/</code></td>
                            <td>即時作業系統（任務、佇列、信號量、定時器）</td>
                        </tr>
                        <tr>
                            <td><strong>FreeRTOS POSIX</strong></td>
                            <td><code>os/freertos_posix/</code></td>
                            <td>POSIX 相容層</td>
                        </tr>
                        <tr>
                            <td><strong>OSAL</strong></td>
                            <td><code>os/ipro_osal/</code></td>
                            <td>作業系統抽象層，統一 API 介面</td>
                        </tr>
                        <tr>
                            <td><strong>Zephyr</strong></td>
                            <td><code>os/zephyr/</code></td>
                            <td>Zephyr RTOS 核心（實驗性）</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>多媒體與 AI</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>元件</th>
                            <th>路徑</th>
                            <th>說明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Audio</strong></td>
                            <td><code>audio/</code></td>
                            <td>音訊框架與編解碼</td>
                        </tr>
                        <tr>
                            <td><strong>AI / NPU</strong></td>
                            <td><code>ai/</code></td>
                            <td>AI 推論引擎，支援 0.1 TOPS NPU 加速</td>
                        </tr>
                        <tr>
                            <td><strong>ISP</strong></td>
                            <td><code>isp_algorithm/</code>, <code>isp_firmware/</code>, <code>isp_iq_param/</code></td>
                            <td>影像訊號處理器（演算法、韌體、IQ 參數）</td>
                        </tr>
                        <tr>
                            <td><strong>Sensor</strong></td>
                            <td><code>sensor/</code></td>
                            <td>攝影機感測器驅動（GC6133、SC101IOT 等）</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>USB 與儲存</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>元件</th>
                            <th>路徑</th>
                            <th>說明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>CherryUSB</strong></td>
                            <td><code>cherryusb/</code></td>
                            <td>USB Device/Host 協定棧（CDC, MSC, HID, UAC, UVC）</td>
                        </tr>
                        <tr>
                            <td><strong>LittleFS</strong></td>
                            <td><code>fs/littlefs/</code></td>
                            <td>針對 Flash 優化的檔案系統</td>
                        </tr>
                        <tr>
                            <td><strong>FatFS</strong></td>
                            <td><code>fs/fatfs/</code></td>
                            <td>FAT 檔案系統（SD 卡）</td>
                        </tr>
                        <tr>
                            <td><strong>EasyFlash</strong></td>
                            <td><code>fs/easyflash4/</code></td>
                            <td>輕量級 KV 儲存</td>
                        </tr>
                        <tr>
                            <td><strong>ROMFS</strong></td>
                            <td><code>fs/romfs/</code></td>
                            <td>唯讀檔案系統</td>
                        </tr>
                        <tr>
                            <td><strong>EVFS</strong></td>
                            <td><code>fs/evfs/</code></td>
                            <td>虛擬檔案系統抽象層</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>第三方函式庫與工具</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>元件</th>
                            <th>路徑</th>
                            <th>說明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Agora</strong></td>
                            <td><code>3rdparty/agora/</code></td>
                            <td>Agora 即時通訊 SDK</td>
                        </tr>
                        <tr>
                            <td><strong>Opus</strong></td>
                            <td><code>3rdparty/opus/</code></td>
                            <td>Opus 音訊編解碼器</td>
                        </tr>
                        <tr>
                            <td><strong>LC3</strong></td>
                            <td><code>3rdparty/liblc3/</code></td>
                            <td>LC3 音訊編解碼器（LE Audio）</td>
                        </tr>
                        <tr>
                            <td><strong>XZ</strong></td>
                            <td><code>3rdparty/xz/</code></td>
                            <td>XZ/LZMA 壓縮解壓</td>
                        </tr>
                        <tr>
                            <td><strong>Zmodem</strong></td>
                            <td><code>3rdparty/zmodem/</code></td>
                            <td>Zmodem 檔案傳輸協定</td>
                        </tr>
                        <tr>
                            <td><strong>Shell</strong></td>
                            <td><code>sys/shell/</code></td>
                            <td>CLI 命令列框架</td>
                        </tr>
                        <tr>
                            <td><strong>Event System</strong></td>
                            <td><code>sys/ipro_event/</code></td>
                            <td>事件系統框架</td>
                        </tr>
                        <tr>
                            <td><strong>Utils</strong></td>
                            <td><code>utils/</code></td>
                            <td>通用工具函式、日誌系統</td>
                        </tr>
                        <tr>
                            <td><strong>SoftCRC</strong></td>
                            <td><code>softcrc/</code></td>
                            <td>軟體 CRC 計算</td>
                        </tr>
                        <tr>
                            <td><strong>libc</strong></td>
                            <td><code>libc/</code></td>
                            <td>C 標準函式庫補充</td>
                        </tr>
                        <tr>
                            <td><strong>Matter</strong></td>
                            <td><code>matter/</code></td>
                            <td>Matter (CHIP) 智慧家庭協定</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Section 6: Configuration System -->
        <section id="configuration">
            <h2>配置系統（Kconfig）</h2>
            <p>SDK 使用 <strong>Linux kernel 風格的 Kconfig</strong> 系統管理專案配置。每個應用擁有自己的 <code>.config</code> 檔案，建構時自動生成 <code>generated/autoconf.h</code> 供 C 程式碼使用。</p>

            <h3>配置層次</h3>
            <ol>
                <li><strong>根配置</strong>：<code>Kconfig</code> - 定義所有可用選項與預設值</li>
                <li><strong>模組配置</strong>：<code>kconfigs/*.config</code> - 各功能模組的預設值</li>
                <li><strong>應用配置</strong>：<code>apps/&lt;project&gt;/.config</code> - 應用專屬配置（最高優先級）</li>
            </ol>

            <h3>關鍵配置選項</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">.config 範例</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash"># SoC 選擇
CONFIG_IPRO7=y
CONFIG_CPU_ID="intelpro_ipro7"

# RTOS 選擇
CONFIG_FREERTOS_SUPPORT=y

# 無線功能
CONFIG_BLUETOOTH_LE_ENABLE=y

# 元件啟用
CONFIG_LWIP=y
CONFIG_MBEDTLS=y

# 測試自動執行
CONFIG_TEST_AUTO_RUN=y</code></pre>
            </div>

            <h3>配置與程式碼的關係</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">generated/autoconf.h（自動生成）</span>
                </div>
                <pre><code class="language-c">/* 由 Kconfig 自動生成，請勿手動編輯 */
#define CONFIG_IPRO7 1
#define CONFIG_CPU_ID "intelpro_ipro7"
#define CONFIG_FREERTOS_SUPPORT 1
#define CONFIG_BLUETOOTH_LE_ENABLE 1
#define CONFIG_LWIP 1</code></pre>
            </div>

            <div class="alert alert-info">
                <strong>提示：</strong><code>CONFIG_CPU_ID</code> 必須在 <code>.config</code> 中正確設定，<code>cmake/toolchain.cmake</code> 才能偵測到正確的架構旗標。工具鏈偵測邏輯會自動區分 vendor GCC（含 <code>_xxldsp</code> DSP 擴充指令）與標準 GCC，並據此調整編譯旗標。
            </div>
        </section>

        <!-- Section 7: Application Structure -->
        <section id="app-structure">
            <h2>應用程式結構</h2>
            <p>每個應用程式都是 <code>apps/</code> 下的獨立目錄，包含建構與配置所需的所有檔案：</p>

            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">典型應用程式結構</span>
                </div>
                <pre><code>apps/&lt;project&gt;/
├── .config              # Kconfig 配置（CONFIG_* 變數）
├── CMakeLists.txt       # CMake 建構定義
├── main.c               # 應用程式入口點
├── src/                 # 原始碼目錄
├── include/             # 標頭檔目錄
└── build/               # 建構輸出（自動生成）
    ├── generated/
    │   └── autoconf.h   # 由 .config 生成的 C 標頭
    └── build_out/
        └── &lt;project&gt;_IPRO7.bin  # 最終二進位檔</code></pre>
            </div>

            <h3>應用分類</h3>
            <p>應用程式依功能分類組織在子目錄中：</p>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>分類</th>
                            <th>路徑</th>
                            <th>範例應用</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Bluetooth</strong></td>
                            <td><code>apps/bluetooth/</code></td>
                            <td>ipro_ble_remote（GATT + OTA）、ipro_le_audio_headset（GAF/BAP）、ipro_walkie_talkie（BIS LE Audio）</td>
                        </tr>
                        <tr>
                            <td><strong>Matter</strong></td>
                            <td><code>apps/matter/</code></td>
                            <td>Matter 智慧家庭裝置</td>
                        </tr>
                        <tr>
                            <td><strong>平台展示</strong></td>
                            <td><code>apps/</code></td>
                            <td>ipro7_demo、ipro6_demo</td>
                        </tr>
                        <tr>
                            <td><strong>測試</strong></td>
                            <td><code>apps/</code></td>
                            <td>ipro_unit_test</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="alert alert-info">
                <strong>提示：</strong>位於子目錄（如 <code>apps/bluetooth/</code>）中的應用需要在 <code>.config</code> 設定 <code>CONFIG_APP_CATEGORY</code>，以便建構系統正確定位專案路徑。
            </div>
        </section>

        <!-- Section 8: Directory Structure -->
        <section id="directory">
            <h2>目錄結構</h2>

            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">SDK 目錄結構</span>
                </div>
                <pre><code>ipro_sdk/
├── apps/                         # 應用程式專案
│   ├── bluetooth/                # BLE 應用（10+ 範例）
│   ├── matter/                   # Matter 智慧家庭應用
│   ├── ipro7_demo/               # IPRO7 綜合平台展示
│   ├── ipro_unit_test/           # 單元測試框架
│   └── ...
│
├── bsp/                          # Board Support Package
│   ├── board/                    # 板級配置（腳位定義、時脈）
│   ├── drivers/                  # 週邊驅動程式
│   ├── hal/                      # 硬體抽象層 API
│   └── common/                   # 共用啟動程式碼與連結腳本
│
├── components/                   # 可重用元件
│   ├── wireless/                 # 無線：BLE、WiFi 6、Thread、Zigbee
│   ├── network/                  # 網路：lwIP
│   ├── crypto/                   # 安全：Mbed TLS、密碼套件
│   ├── os/                       # RTOS：FreeRTOS、Zephyr、OSAL
│   ├── fs/                       # 檔案系統：LittleFS、FatFS、ROMFS
│   ├── cherryusb/                # USB 協定棧
│   ├── audio/                    # 音訊框架
│   ├── ai/                       # AI/NPU 推論
│   ├── sensor/                   # 攝影機感測器驅動
│   ├── sys/                      # 系統服務（Shell、事件）
│   ├── 3rdparty/                 # 第三方：Agora、Opus、LC3、XZ
│   ├── matter/                   # Matter 協定
│   └── ...                       # libc、softcrc、utils、ISP 等
│
├── tools/                        # 開發工具
│   ├── ipro_iot_tool_lite/       # 燒錄工具
│   ├── serial_monitor.py         # 串口監控
│   ├── board_test.sh             # 自動化板級測試
│   └── vscode_extension/         # VS Code 擴充
│
├── cmake/                        # CMake 設定（toolchain.cmake）
├── kconfigs/                     # Kconfig 預設配置檔
├── build_freertos.sh             # FreeRTOS 建構腳本
├── Kconfig                       # 根 Kconfig
└── west.yml                      # Zephyr west 配置</code></pre>
            </div>
        </section>

        <!-- Section 9: BLE Stack -->
        <section id="ble-stack">
            <h2>BLE 棧架構</h2>
            <p>BLE 5.4 棧位於 <code>components/wireless/bluetooth/</code>，採用 Zephyr 風格回調式 GAP/GATT API：</p>

            <div class="protocol-stack">
                <div class="stack-layer stack-green">
                    <div class="layer-name">Application</div>
                    <div class="layer-detail">使用者應用程式</div>
                </div>
                <div class="stack-layer stack-cyan">
                    <div class="layer-name">Profiles (btprofile/)</div>
                    <div class="layer-detail">70+ BLE Profile 實作</div>
                </div>
                <div class="stack-layer stack-cyan">
                    <div class="layer-name">GAP / GATT / SMP</div>
                    <div class="layer-detail">Zephyr BLE Host API</div>
                </div>
                <div class="stack-layer stack-purple">
                    <div class="layer-name">L2CAP</div>
                    <div class="layer-detail">邏輯通道管理</div>
                </div>
                <div class="stack-layer stack-amber">
                    <div class="layer-name">HCI (On-chip)</div>
                    <div class="layer-detail">ipro_hci_wrapper</div>
                </div>
                <div class="stack-layer stack-red">
                    <div class="layer-name">Controller (btblecontroller/)</div>
                    <div class="layer-detail">RivieraWaves 預編譯 linkN 變體</div>
                </div>
            </div>

            <h3>控制器變體（linkN 命名）</h3>
            <p>控制器使用統一連線池設計，以 <code>linkN</code> 命名（取代舊的 <code>mXsY</code> 命名）：</p>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>變體</th>
                            <th>BLE 版本</th>
                            <th>說明</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>link1_periph</code>, <code>link1</code>, <code>link2</code>, <code>link4</code>, <code>link8</code></td>
                            <td>BLE 5.0+</td>
                            <td>基礎 BLE，不同連線數（1/2/4/8 連線）</td>
                        </tr>
                        <tr>
                            <td><code>link1_leaudio</code>, <code>link2_leaudio</code></td>
                            <td>BLE 5.2</td>
                            <td>含 LE Audio 支援（ISO、CIS/BIS）</td>
                        </tr>
                        <tr>
                            <td><code>link1_leaudio_53_54</code>, <code>link2_leaudio_53_54</code></td>
                            <td>BLE 5.4</td>
                            <td>完整 LE Audio + BLE 5.3/5.4 功能</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>預建函式庫</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">建構預建控制器函式庫</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash"># 建構指定變體
components/wireless/bluetooth/build_all_prebuilts.sh link2

# 建構所有變體
components/wireless/bluetooth/build_all_prebuilts.sh all

# 輸出：btblecontroller_ipro7_&lt;variant&gt;/libbtblecontroller_ipro7_&lt;variant&gt;.a</code></pre>
            </div>

            <div class="alert alert-warning">
                <strong>注意：</strong><code>CONFIG_BLE_FORCE_SOURCE_BUILD</code> 不可用於正式發布版本。正式版必須使用預建函式庫。
            </div>

            <h3>LE Audio 應用框架</h3>
            <p>LE Audio 應用採用三層框架設計：</p>
            <ul>
                <li><strong>Mediator（協調器）</strong>：統籌管理所有元件與狀態機</li>
                <li><strong>Applets（可重用元件）</strong>：封裝 BLE Profile 功能（GAF, BAP, VCP, MCP, CAP）</li>
                <li><strong>Intermediaries（協定橋接）</strong>：連接不同協定層的資料流</li>
            </ul>
        </section>

        <!-- Section 10: BSP & Drivers -->
        <section id="bsp">
            <h2>BSP 與驅動</h2>
            <p>Board Support Package 位於 <code>bsp/</code> 目錄，提供硬體抽象與週邊驅動：</p>

            <ul>
                <li><code>bsp/hal/</code> - 硬體抽象層 API</li>
                <li><code>bsp/drivers/</code> - 週邊驅動程式</li>
                <li><code>bsp/board/</code> - 板級配置（腳位映射、時脈設定）</li>
                <li><code>bsp/common/</code> - 啟動程式碼、連結腳本、共用程式碼</li>
            </ul>

            <h3>支援的週邊驅動</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>類別</th>
                            <th>驅動</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>通訊介面</td>
                            <td>UART, SPI (主/從), I2C, I2S</td>
                        </tr>
                        <tr>
                            <td>儲存</td>
                            <td>SD 卡 (SDH), SPI Flash, PSRAM</td>
                        </tr>
                        <tr>
                            <td>顯示</td>
                            <td>LCD (ILI9488 SPI), OSD blend/draw</td>
                        </tr>
                        <tr>
                            <td>音訊</td>
                            <td>AUADC, DAC, I2S</td>
                        </tr>
                        <tr>
                            <td>多媒體</td>
                            <td>ISP 攝影機, DVP sensor, MJPEG 編解碼</td>
                        </tr>
                        <tr>
                            <td>網路</td>
                            <td>EMAC 乙太網</td>
                        </tr>
                        <tr>
                            <td>USB</td>
                            <td>Device (CDC, MSC, HID, UAC, UVC)</td>
                        </tr>
                        <tr>
                            <td>其他</td>
                            <td>GPIO, PWM, ADC, Timer, IR, QDEC, DMA</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </article>
</div>
