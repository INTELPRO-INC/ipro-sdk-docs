---
layout: default
title: BLE é–‹ç™¼æŒ‡å—
---

<div class="doc-layout">
    <aside class="doc-sidebar">
        <nav class="sidebar-nav">
            <h4 class="sidebar-title">æœ¬é ç›®éŒ„</h4>
            <ul class="sidebar-links">
                <li><a href="#overview" class="sidebar-link">BLE 5.4 æ¦‚è¦½</a></li>
                <li><a href="#architecture" class="sidebar-link">ç¨‹å¼åº«æ¶æ§‹</a></li>
                <li><a href="#controller-variants" class="sidebar-link">æ§åˆ¶å™¨è®Šé«”</a></li>
                <li><a href="#getting-started" class="sidebar-link">å¿«é€Ÿé–‹å§‹</a></li>
                <li><a href="#gap-operations" class="sidebar-link">GAP æ“ä½œ</a></li>
                <li><a href="#gatt-services" class="sidebar-link">GATT æœå‹™</a></li>
                <li><a href="#le-audio" class="sidebar-link">LE Audio</a></li>
                <li><a href="#throughput" class="sidebar-link">å‚³è¼¸æ•ˆèƒ½å„ªåŒ–</a></li>
                <li><a href="#prebuilt-libs" class="sidebar-link">é å»ºæ§‹ç¨‹å¼åº«</a></li>
                <li><a href="#debugging" class="sidebar-link">é™¤éŒ¯æŠ€å·§</a></li>
                <li><a href="#best-practices" class="sidebar-link">æœ€ä½³å¯¦è¸</a></li>
                <li><a href="#reference-apps" class="sidebar-link">åƒè€ƒæ‡‰ç”¨</a></li>
            </ul>
        </nav>
    </aside>

    <article class="doc-content">
        <h1>BLE é–‹ç™¼æŒ‡å—</h1>
        <p>æœ¬æŒ‡å—ä»‹ç´¹å¦‚ä½•ä½¿ç”¨ IPRO SDK çš„ Zephyr BLE Host Stack é–‹ç™¼è—ç‰™ä½åŠŸè€—æ‡‰ç”¨ã€‚SDK æ¡ç”¨ Zephyr æ¨™æº– <code>bt_*</code> APIï¼Œæ­é… RivieraWaves æ§åˆ¶å™¨ï¼Œæä¾›å®Œæ•´çš„ BLE 5.4 åŠŸèƒ½ã€‚</p>

        <section id="overview">
            <h2>BLE 5.4 åŠŸèƒ½æ¦‚è¦½</h2>
            <p>IPRO SDK æ•´åˆäº† Zephyr BLE Host Stack èˆ‡ RivieraWaves æ§åˆ¶å™¨ï¼Œæä¾›å®Œæ•´çš„è—ç‰™åŠŸèƒ½ï¼š</p>

            <div class="features-grid" style="margin: 2rem 0;">
                <div class="feature-card">
                    <div class="feature-icon">ğŸ“¡</div>
                    <h3 class="feature-title">æ ¸å¿ƒåŠŸèƒ½</h3>
                    <ul style="margin-top: 1rem; color: var(--text-secondary);">
                        <li>BLE 5.4 Host Stack (Zephyr bt_* API)</li>
                        <li>æœ€å¤š 8 å€‹åŒæ™‚é€£ç·šï¼ˆçµ±ä¸€é€£ç·šæ± ï¼‰</li>
                        <li>23 å€‹ GATT Profiles</li>
                        <li>999 Kbps å¯¦æ¸¬å‚³è¼¸é€Ÿç‡</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸµ</div>
                    <h3 class="feature-title">LE Audio</h3>
                    <ul style="margin-top: 1rem; color: var(--text-secondary);">
                        <li>LC3 ç·¨è§£ç¢¼ï¼ˆ32-320 kbpsï¼‰</li>
                        <li>BAP / CAP / VCP / MCP / CSIP</li>
                        <li>&lt;20ms éŸ³è¨Šå»¶é²</li>
                        <li>Isochronous Channels</li>
                    </ul>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ”’</div>
                    <h3 class="feature-title">å®‰å…¨æ€§</h3>
                    <ul style="margin-top: 1rem; color: var(--text-secondary);">
                        <li>LE Secure Connections</li>
                        <li>AES-CCM åŠ å¯†</li>
                        <li>é…å°èˆ‡ç¶å®šç®¡ç†</li>
                        <li>éš±ç§åŠŸèƒ½ï¼ˆRPAï¼‰</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="architecture">
            <h2>ç¨‹å¼åº«æ¶æ§‹</h2>
            <p>BLE å”å®šæ£§æ¡ç”¨ Zephyr Host + RivieraWaves Controller é›™å±¤æ¶æ§‹ï¼Œæ‡‰ç”¨ç¨‹å¼ä½¿ç”¨æ¨™æº– Zephyr <code>bt_*</code> APIï¼š</p>

            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">BLE Stack æ¶æ§‹</span>
                </div>
                <pre><code>components/wireless/bluetooth/
â”œâ”€â”€ blestack/                        # Zephyr BLE Host Stackï¼ˆå¯å»ºæ§‹åŸå§‹ç¢¼ï¼‰
â”‚   â””â”€â”€ src/include/bluetooth/       # å…¬é–‹æ¨™é ­æª”
â”‚       â”œâ”€â”€ bluetooth.h              # bt_enable(), bt_le_adv_start()
â”‚       â”œâ”€â”€ conn.h                   # bt_conn_create_le(), bt_conn_cb_register()
â”‚       â”œâ”€â”€ gatt.h                   # bt_gatt_service_register(), bt_gatt_notify()
â”‚       â”œâ”€â”€ uuid.h                   # BT_UUID_DECLARE_16() ç­‰
â”‚       â””â”€â”€ audio/                   # LE Audio APIï¼ˆBAP, CAP, VCP...ï¼‰
â”œâ”€â”€ btblecontroller/                 # RivieraWaves æ§åˆ¶å™¨ï¼ˆé å»ºæ§‹ linkN è®Šé«”åº«ï¼‰
â”œâ”€â”€ btprofile/                       # 23 å€‹ GATT Profiles
â”‚   â”œâ”€â”€ bas/   dis/   hogp/          # é›»æ± ã€è£ç½®è³‡è¨Šã€HID
â”‚   â”œâ”€â”€ csip/  otp/   find/          # CSIPã€OTPã€Find Me
â”‚   â””â”€â”€ ...
â”œâ”€â”€ ble_common.cmake                 # æ§åˆ¶å™¨è®Šé«”é…ç½®
â””â”€â”€ btble_inc/                       # èˆŠç‰ˆç›¸å®¹æ¨™é ­æª”</code></pre>
            </div>

            <h3>æ ¸å¿ƒæ¦‚å¿µ</h3>
            <ul>
                <li><strong>Zephyr bt_* API</strong>ï¼šæ‡‰ç”¨ç¨‹å¼ä½¿ç”¨æ¨™æº– Zephyr BLE APIï¼ˆå–ä»£å·²æ£„ç”¨çš„ ipro_ble_api.hï¼‰</li>
                <li><strong>å›èª¿é©…å‹•</strong>ï¼šä½¿ç”¨ <code>bt_conn_cb_register()</code> è¨»å†Šé€£ç·šå›èª¿</li>
                <li><strong>éœæ…‹æœå‹™å®šç¾©</strong>ï¼šä½¿ç”¨ <code>BT_GATT_SERVICE_DEFINE()</code> å·¨é›†å®šç¾© GATT æœå‹™</li>
                <li><strong>çµ±ä¸€é€£ç·šæ± </strong>ï¼šlinkN è®Šé«”ä¸­ N = ç¸½é€£ç·šæ•¸ï¼ŒCentral/Peripheral ä»»æ„çµ„åˆ</li>
            </ul>
        </section>

        <section id="controller-variants">
            <h2>æ§åˆ¶å™¨è®Šé«”ï¼ˆlinkN å‘½åï¼‰</h2>
            <p>æ§åˆ¶å™¨æ¡ç”¨çµ±ä¸€é€£ç·šæ± æ¶æ§‹ï¼ŒlinkN ä¸­çš„ N è¡¨ç¤ºåŒæ™‚é€£ç·šæ•¸ï¼Œæ¯å€‹é€£ç·šæ§½å¯ä½œç‚º Central æˆ– Peripheral ä½¿ç”¨ï¼š</p>

            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>è®Šé«”</th>
                            <th>é€£ç·šæ•¸</th>
                            <th>TX Buffers</th>
                            <th>è§’è‰²æ”¯æ´</th>
                            <th>èªªæ˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>link1_periph</code></td>
                            <td>1</td>
                            <td>2</td>
                            <td>Peripheral only</td>
                            <td>æœ€å°å°ºå¯¸ï¼Œåƒ…å‘¨é‚Šè¨­å‚™</td>
                        </tr>
                        <tr>
                            <td><code>link1</code></td>
                            <td>1</td>
                            <td>2</td>
                            <td>All roles</td>
                            <td>å–®é€£ç·šï¼Œæ”¯æ´æ‰€æœ‰è§’è‰²</td>
                        </tr>
                        <tr>
                            <td><code>link2</code></td>
                            <td>2</td>
                            <td>4</td>
                            <td>All roles</td>
                            <td>é›™é€£ç·šï¼ˆ2C+0P, 1C+1P, 0C+2Pï¼‰</td>
                        </tr>
                        <tr>
                            <td><code>link4</code></td>
                            <td>4</td>
                            <td>6</td>
                            <td>All roles</td>
                            <td>å››é€£ç·šï¼Œä»»æ„çµ„åˆ</td>
                        </tr>
                        <tr>
                            <td><code>link8</code></td>
                            <td>8</td>
                            <td>8</td>
                            <td>All roles</td>
                            <td>å…«é€£ç·šï¼Œä»»æ„çµ„åˆ</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3>LE Audio èˆ‡ BLE 5.3/5.4 å¾Œç¶´</h3>
            <p>åŸºç¤è®Šé«”å¯åŠ ä¸Šå¾Œç¶´å•Ÿç”¨é€²éšåŠŸèƒ½ï¼š</p>
            <ul>
                <li><code>_leaudio</code> â€” BLE 5.2 + LE Audioï¼ˆBAP, CAP, VCP, MCP, CSIPï¼‰</li>
                <li><code>_leaudio_53_54</code> â€” BLE 5.4 + LE Audioï¼ˆæœ€å®Œæ•´åŠŸèƒ½ï¼‰</li>
            </ul>
            <p>ä¾‹å¦‚ï¼š<code>link1_leaudio</code>ã€<code>link2_leaudio_53_54</code></p>

            <h3>Kconfig é…ç½®</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">.config è®Šé«”é¸æ“‡</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash"># é¸æ“‡æ§åˆ¶å™¨è®Šé«”
CONFIG_BTBLECONTROLLER_LIB="link2"

# æˆ–ä½¿ç”¨å¸ƒæ—æ——æ¨™çµ„åˆ
CONFIG_BTBLECONTROLLER_LIB="link2"
CONFIG_BTBLECONTROLLER_LE_AUDIO=y     # åŠ ä¸Š _leaudio
CONFIG_BTBLECONTROLLER_BT_54=y        # åŠ ä¸Š _53_54ï¼ˆ5.4 éš±å« 5.3ï¼‰</code></pre>
            </div>
        </section>

        <section id="getting-started">
            <h2>å¿«é€Ÿé–‹å§‹</h2>

            <h3>1. åˆå§‹åŒ– BLE å­ç³»çµ±</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">BLE åˆå§‹åŒ–ï¼ˆZephyr bt_* APIï¼‰</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-c">#include &lt;bluetooth/bluetooth.h&gt;
#include &lt;bluetooth/conn.h&gt;
#include &lt;bluetooth/gatt.h&gt;

/* é€£ç·šå›èª¿ */
static void connected(struct bt_conn *conn, u8_t err)
{
    if (err) {
        printk("Connection failed (err %u)\n", err);
        return;
    }
    printk("Connected\n");
}

static void disconnected(struct bt_conn *conn, u8_t reason)
{
    printk("Disconnected (reason %u)\n", reason);
}

static struct bt_conn_cb conn_callbacks = {
    .connected = connected,
    .disconnected = disconnected,
};

/* BLE å°±ç·’å›èª¿ */
static void bt_ready(int err)
{
    if (err) {
        printk("Bluetooth init failed (err %d)\n", err);
        return;
    }
    printk("Bluetooth initialized\n");

    /* é–‹å§‹å»£æ’­ */
    start_advertising();
}

void app_init(void)
{
    /* è¨»å†Šé€£ç·šå›èª¿ */
    bt_conn_cb_register(&conn_callbacks);

    /* å•Ÿç”¨è—ç‰™ */
    int err = bt_enable(bt_ready);
    if (err) {
        printk("bt_enable failed (err %d)\n", err);
    }
}</code></pre>
            </div>

            <h3>2. é…ç½®å»£æ’­</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">å»£æ’­è¨­ç½®</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-c">static const struct bt_data ad[] = {
    BT_DATA_BYTES(BT_DATA_FLAGS,
                  BT_LE_AD_GENERAL | BT_LE_AD_NO_BREDR),
    BT_DATA_BYTES(BT_DATA_UUID16_ALL,
                  0x0d, 0x18),  /* Heart Rate Service */
};

static const struct bt_data sd[] = {
    BT_DATA(BT_DATA_NAME_COMPLETE, "IPRO Device", 11),
};

void start_advertising(void)
{
    int err = bt_le_adv_start(BT_LE_ADV_CONN_NAME,
                              ad, ARRAY_SIZE(ad),
                              sd, ARRAY_SIZE(sd));
    if (err) {
        printk("Advertising failed to start (err %d)\n", err);
    }
}</code></pre>
            </div>

            <h3>3. å•Ÿç”¨é…ç½®é¸é …</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">.config</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash"># å•Ÿç”¨ BLE
CONFIG_BLUETOOTH_LE_ENABLE=y
CONFIG_BTBLECONTROLLER_LIB="link2"

# å•Ÿç”¨é™¤éŒ¯è¼¸å‡º
CONFIG_LOG_DEFAULT_LEVEL=4</code></pre>
            </div>
        </section>

        <section id="gap-operations">
            <h2>GAP æ“ä½œ</h2>

            <h3>å»£æ’­ç®¡ç†</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">å»£æ’­æ§åˆ¶</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-c">/* ä½¿ç”¨é è¨­åƒæ•¸é–‹å§‹å¯é€£ç·šå»£æ’­ */
bt_le_adv_start(BT_LE_ADV_CONN, ad, ARRAY_SIZE(ad), sd, ARRAY_SIZE(sd));

/* ä½¿ç”¨è‡ªè¨‚åƒæ•¸ */
struct bt_le_adv_param param = {
    .options = BT_LE_ADV_OPT_CONNECTABLE | BT_LE_ADV_OPT_USE_NAME,
    .interval_min = BT_GAP_ADV_FAST_INT_MIN_2,
    .interval_max = BT_GAP_ADV_FAST_INT_MAX_2,
};
bt_le_adv_start(&param, ad, ARRAY_SIZE(ad), sd, ARRAY_SIZE(sd));

/* åœæ­¢å»£æ’­ */
bt_le_adv_stop();</code></pre>
            </div>

            <h3>é€£ç·šç®¡ç†</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">é€£ç·šæ“ä½œ</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-c">/* ç™¼èµ·é€£ç·šï¼ˆCentral è§’è‰²ï¼‰ */
struct bt_conn *conn = bt_conn_create_le(&peer_addr,
                                          BT_LE_CONN_PARAM_DEFAULT);

/* æ›´æ–°é€£ç·šåƒæ•¸ */
struct bt_le_conn_param param = {
    .interval_min = 24,   /* 30ms */
    .interval_max = 40,   /* 50ms */
    .latency = 0,
    .timeout = 400,       /* 4s */
};
bt_conn_le_param_update(conn, &param);

/* æ–·é–‹é€£ç·š */
bt_conn_disconnect(conn, BT_HCI_ERR_REMOTE_USER_TERM_CONN);</code></pre>
            </div>
        </section>

        <section id="gatt-services">
            <h2>GATT æœå‹™</h2>

            <h3>éœæ…‹æœå‹™å®šç¾©</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">è‡ªè¨‚ GATT æœå‹™ç¯„ä¾‹</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-c">#include &lt;bluetooth/gatt.h&gt;
#include &lt;bluetooth/uuid.h&gt;

/* å®šç¾©è‡ªè¨‚ UUID */
static struct bt_uuid_128 custom_svc_uuid = BT_UUID_INIT_128(
    0xf0, 0xde, 0xbc, 0x9a, 0x78, 0x56, 0x34, 0x12,
    0x78, 0x56, 0x34, 0x12, 0x78, 0x56, 0x34, 0x12);

static struct bt_uuid_128 custom_char_uuid = BT_UUID_INIT_128(
    0xf1, 0xde, 0xbc, 0x9a, 0x78, 0x56, 0x34, 0x12,
    0x78, 0x56, 0x34, 0x12, 0x78, 0x56, 0x34, 0x12);

static uint8_t custom_value[512];

/* è®€å–å›èª¿ */
static ssize_t read_custom(struct bt_conn *conn,
                           const struct bt_gatt_attr *attr,
                           void *buf, u16_t len, u16_t offset)
{
    return bt_gatt_attr_read(conn, attr, buf, len, offset,
                             custom_value, sizeof(custom_value));
}

/* ä½¿ç”¨å·¨é›†éœæ…‹å®šç¾©æœå‹™ */
BT_GATT_SERVICE_DEFINE(custom_svc,
    BT_GATT_PRIMARY_SERVICE(&custom_svc_uuid),
    BT_GATT_CHARACTERISTIC(&custom_char_uuid.uuid,
                           BT_GATT_CHRC_READ | BT_GATT_CHRC_NOTIFY,
                           BT_GATT_PERM_READ,
                           read_custom, NULL, custom_value),
    BT_GATT_CCC(NULL, BT_GATT_PERM_READ | BT_GATT_PERM_WRITE),
);

/* ç™¼é€é€šçŸ¥ */
void notify_custom_value(struct bt_conn *conn)
{
    bt_gatt_notify(conn, &custom_svc.attrs[1],
                   custom_value, sizeof(custom_value));
}</code></pre>
            </div>

            <h3>å‹•æ…‹æœå‹™è¨»å†Š</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">å‹•æ…‹è¨»å†Š</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-c">/* å‹•æ…‹æœå‹™å±¬æ€§é™£åˆ— */
static struct bt_gatt_attr svc_attrs[] = { /* ... */ };
static struct bt_gatt_service svc = BT_GATT_SERVICE(svc_attrs);

/* åŸ·è¡ŒæœŸé–“è¨»å†Š */
int err = bt_gatt_service_register(&svc);</code></pre>
            </div>

            <h3>å…§å»º Profilesï¼ˆbtprofile/ï¼‰</h3>
            <p>SDK æä¾› 23 å€‹ GATT Profile å¯¦ä½œï¼š</p>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>Profile</th>
                            <th>èªªæ˜</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td><code>bas</code></td><td>Battery Service</td></tr>
                        <tr><td><code>dis</code></td><td>Device Information Service</td></tr>
                        <tr><td><code>hogp</code></td><td>HID over GATT Profile</td></tr>
                        <tr><td><code>csip</code></td><td>Coordinated Set Identification Profile</td></tr>
                        <tr><td><code>otp</code></td><td>Object Transfer Profile</td></tr>
                        <tr><td><code>find</code></td><td>Find Me Profile</td></tr>
                        <tr><td><code>tip</code></td><td>Time Profile</td></tr>
                        <tr><td><code>anp</code></td><td>Alert Notification Profile</td></tr>
                        <tr><td><code>hogp</code></td><td>HID over GATT Profile</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section id="le-audio">
            <h2>LE Audio</h2>
            <p>SDK æ”¯æ´å®Œæ•´çš„ LE Audio åŠŸèƒ½ï¼Œéœ€ä½¿ç”¨ <code>_leaudio</code> å¾Œç¶´çš„æ§åˆ¶å™¨è®Šé«”ã€‚æ¨™é ­æª”ä½æ–¼ <code>bluetooth/audio/</code>ã€‚</p>

            <h3>æ”¯æ´çš„ LE Audio Profiles</h3>
            <ul>
                <li><strong>BAP</strong> â€” Basic Audio Profileï¼ˆå–®æ’­/å»£æ’­éŸ³è¨Šä¸²æµï¼‰</li>
                <li><strong>CAP</strong> â€” Common Audio Profileï¼ˆå”èª¿éŸ³è¨Šæ“ä½œï¼‰</li>
                <li><strong>VCP</strong> â€” Volume Control Profile</li>
                <li><strong>MCP</strong> â€” Media Control Profile</li>
                <li><strong>CSIP</strong> â€” Coordinated Set Identification Profile</li>
            </ul>

            <h3>LE Audio æœå‹™</h3>
            <ul>
                <li><strong>ASCS</strong> (0x184E) - Audio Stream Control Service</li>
                <li><strong>PACS</strong> (0x1850) - Published Audio Capabilities Service</li>
                <li><strong>CAS</strong> (0x1853) - Common Audio Service</li>
            </ul>

            <h3>é…ç½®</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">.config LE Audio é…ç½®</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash"># å•Ÿç”¨ LE Audio æ§åˆ¶å™¨
CONFIG_BTBLECONTROLLER_LIB="link2"
CONFIG_BTBLECONTROLLER_LE_AUDIO=y
CONFIG_BTBLECONTROLLER_BT_54=y

# çµæœè®Šé«”ï¼šlink2_leaudio_53_54</code></pre>
            </div>

            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">LE Audio å»£æ’­è³‡æ–™</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-c">static const struct bt_data le_audio_ad[] = {
    BT_DATA_BYTES(BT_DATA_FLAGS,
                  BT_LE_AD_GENERAL | BT_LE_AD_NO_BREDR),
    BT_DATA_BYTES(BT_DATA_UUID16_ALL,
                  0x4E, 0x18,  /* ASCS */
                  0x50, 0x18,  /* PACS */
                  0x53, 0x18), /* CAS */
};</code></pre>
            </div>
        </section>

        <section id="throughput">
            <h2>å‚³è¼¸æ•ˆèƒ½å„ªåŒ–</h2>

            <h3>é€£ç·šåƒæ•¸èˆ‡ TX æè¿°ç¬¦</h3>
            <p>å½±éŸ¿ååé‡çš„é—œéµåƒæ•¸ï¼š</p>
            <ul>
                <li><strong>max_ce_len</strong>ï¼šé€£ç·šäº‹ä»¶æœ€å¤§é•·åº¦ï¼Œå€¼è¶Šå¤§æ¯å€‹äº‹ä»¶å¯å‚³è¼¸è¶Šå¤šå°åŒ…</li>
                <li><strong>BLE_NB_TX_DESC_PER_CON</strong>ï¼šæ¯é€£ç·š TX æè¿°ç¬¦æ•¸é‡</li>
                <li><strong>CONFIG_BLE_TX_BUFF_DATA</strong>ï¼šTX ç·©è¡å€æ•¸é‡ï¼ˆéš¨ linkN è®Šé«”è‡ªå‹•èª¿æ•´ï¼‰</li>
            </ul>

            <h3>MTU å„ªåŒ–</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">MTU èˆ‡é«˜é€Ÿå‚³è¼¸</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-c">/* MTU å”å•†å¾Œè¨ˆç®—æœ€ä½³ payload */
uint16_t mtu = bt_gatt_get_mtu(conn);
uint16_t payload = (mtu > 3) ? (mtu - 3) : 20;  /* ATT header = 3 bytes */

/* ç™¼é€é€šçŸ¥ */
bt_gatt_notify(conn, attr, data, payload);</code></pre>
            </div>

            <div class="alert alert-info">
                <strong>ğŸ’¡ æ•ˆèƒ½åŸºæº–ï¼š</strong>
                <ul style="margin-top: 0.5rem; margin-bottom: 0;">
                    <li>MTU 517 + å„ªåŒ– TX æè¿°ç¬¦ï¼š<strong>999 Kbps</strong> å¯¦æ¸¬å‚³è¼¸é€Ÿç‡</li>
                    <li>åœ–ç‰‡å‚³è¼¸ï¼š56KB åœ¨ 542ms å®Œæˆï¼Œé” 101.4 KB/s (811 Kbps)</li>
                    <li>TX buffer éš¨è®Šé«”è‡ªå‹•èª¿æ•´ï¼šlink1=2, link2=4, link4=6, link8=8</li>
                </ul>
            </div>
        </section>

        <section id="prebuilt-libs">
            <h2>é å»ºæ§‹ç¨‹å¼åº«</h2>
            <p>æ§åˆ¶å™¨ä»¥é å»ºæ§‹éœæ…‹åº«å½¢å¼æä¾›ã€‚ç™¼è¡Œç‰ˆä¸å¯ä½¿ç”¨ <code>CONFIG_BLE_FORCE_SOURCE_BUILD</code>ã€‚</p>

            <h3>å»ºæ§‹è…³æœ¬</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">å»ºæ§‹é å»ºæ§‹ç¨‹å¼åº«</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash"># å»ºæ§‹ç‰¹å®šè®Šé«”
components/wireless/bluetooth/build_all_prebuilts.sh link2

# å»ºæ§‹æ‰€æœ‰è®Šé«”
components/wireless/bluetooth/build_all_prebuilts.sh all

# è¼¸å‡ºï¼šbtblecontroller_ipro7_link2/libbtblecontroller_ipro7_link2.a</code></pre>
            </div>

            <div class="alert alert-warning">
                <strong>âš ï¸ é‡è¦ï¼š</strong><code>CONFIG_BLE_FORCE_SOURCE_BUILD</code> åƒ…ä¾›é–‹ç™¼é™¤éŒ¯ä½¿ç”¨ï¼Œä¸å¯ç”¨æ–¼æ­£å¼ç™¼è¡Œç‰ˆæœ¬ã€‚
            </div>
        </section>

        <section id="debugging">
            <h2>é™¤éŒ¯æŠ€å·§</h2>

            <h3>å•Ÿç”¨é™¤éŒ¯æ—¥èªŒ</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">.config</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash"># å•Ÿç”¨ BLE é™¤éŒ¯
CONFIG_LOG_DEFAULT_LEVEL=4  # DEBUG level</code></pre>
            </div>

            <h3>å¸¸è¦‹éŒ¯èª¤ç¢¼</h3>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>éŒ¯èª¤ç¢¼</th>
                            <th>èªªæ˜</th>
                            <th>è§£æ±ºæ–¹æ¡ˆ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>0x0043</code></td>
                            <td>Activity already stopped</td>
                            <td>æª¢æŸ¥æ´»å‹•ç‹€æ…‹å†åŸ·è¡Œåœæ­¢</td>
                        </tr>
                        <tr>
                            <td><code>0x004B</code></td>
                            <td>Activity creation failed</td>
                            <td>ç¢ºä¿å®Œæ•´æ¸…ç†ï¼šStop â†’ Delete â†’ Reset</td>
                        </tr>
                        <tr>
                            <td><code>0x00A3</code></td>
                            <td>Connection terminated</td>
                            <td>è™•ç†æ–·ç·šäº‹ä»¶ï¼Œå¯¦ä½œé‡é€£æ©Ÿåˆ¶</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section id="best-practices">
            <h2>æœ€ä½³å¯¦è¸</h2>

            <h3>1. é‡é€£æ©Ÿåˆ¶</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">è‡ªå‹•é‡é€£å¯¦ä½œ</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-c">static void disconnected(struct bt_conn *conn, u8_t reason)
{
    /* å»¶é²å¾Œé‡æ–°å»£æ’­ */
    k_sleep(K_MSEC(500));

    int err = bt_le_adv_start(BT_LE_ADV_CONN_NAME,
                              ad, ARRAY_SIZE(ad),
                              sd, ARRAY_SIZE(sd));
    if (err) {
        printk("Re-advertising failed (err %d)\n", err);
    }
}</code></pre>
            </div>

            <h3>2. æ¸¬è©¦é©—è­‰</h3>
            <ul>
                <li>å¤šæ¬¡æ–·ç·šé‡é€£å¾ªç’°æ¸¬è©¦</li>
                <li>æ‰‹æ©Ÿ/ä¸­å¤®è¨­å‚™å¯æ­£ç¢ºç™¼ç¾èˆ‡é…å°</li>
                <li>LE Audio æœå‹™ï¼ˆASCS, PACS, CASï¼‰å¯å­˜å–</li>
                <li>ç„¡ 0x004B è³‡æºéŒ¯èª¤</li>
                <li>è¨˜æ†¶é«”ä½¿ç”¨ç©©å®š</li>
            </ul>
        </section>

        <section id="reference-apps">
            <h2>åƒè€ƒæ‡‰ç”¨</h2>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>æ‡‰ç”¨</th>
                            <th>åŠŸèƒ½</th>
                            <th>è·¯å¾‘</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>ipro_ble_remote</strong></td>
                            <td>GATT + OTA æ›´æ–°</td>
                            <td><code>apps/bluetooth/ipro_ble_remote/</code></td>
                        </tr>
                        <tr>
                            <td><strong>ipro_walkie_talkie</strong></td>
                            <td>BIS LE Audio å»£æ’­</td>
                            <td><code>apps/bluetooth/ipro_walkie_talkie/</code></td>
                        </tr>
                        <tr>
                            <td><strong>ipro_le_audio_headset</strong></td>
                            <td>GAF/BAP å–®æ’­éŸ³è¨Š</td>
                            <td><code>apps/bluetooth/ipro_le_audio_headset/</code></td>
                        </tr>
                        <tr>
                            <td><strong>ipro_throughput_test</strong></td>
                            <td>å‚³è¼¸é€Ÿç‡åŸºæº–æ¸¬è©¦</td>
                            <td><code>apps/bluetooth/ipro_throughput_test/</code></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>
    </article>
</div>
