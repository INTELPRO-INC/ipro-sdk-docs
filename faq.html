---
layout: default
title: 常見問題 FAQ
lang: zh-TW
---

<section class="page-header-section">
    <div class="container">
        <h1 class="page-title">常見問題 FAQ</h1>
        <p class="page-subtitle">快速解決開發過程中遇到的問題</p>
    </div>
</section>

<section class="faq-section">
    <div class="container">
        <!-- FAQ Categories Navigation -->
        <div class="faq-categories">
            <button class="faq-category-btn active" data-category="all">
                <i class="fas fa-list"></i> 全部
            </button>
            <button class="faq-category-btn" data-category="build">
                <i class="fas fa-hammer"></i> Build 編譯
            </button>
            <button class="faq-category-btn" data-category="ble">
                <i class="fas fa-bluetooth-b"></i> BLE 藍牙
            </button>
            <button class="faq-category-btn" data-category="rf">
                <i class="fas fa-broadcast-tower"></i> RF 射頻
            </button>
            <button class="faq-category-btn" data-category="debug">
                <i class="fas fa-bug"></i> Debug 除錯
            </button>
            <button class="faq-category-btn" data-category="rtos">
                <i class="fas fa-microchip"></i> RTOS
            </button>
        </div>

        <!-- Search Box -->
        <div class="faq-search">
            <i class="fas fa-search"></i>
            <input type="text" id="faq-search-input" placeholder="搜尋問題...">
        </div>

        <!-- FAQ Items -->
        <div class="faq-list">

            <!-- Build Category -->
            <div class="faq-item" data-category="build">
                <div class="faq-question">
                    <span class="faq-badge build">Build</span>
                    <h3>make -C apps/&lt;project&gt; 和 build_freertos.sh 有什麼區別？</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>兩者功能相同，<code>make -C apps/&lt;project&gt;</code> 是推薦的方式，它內部會委派給 <code>project.build</code> 腳本。<code>build_freertos.sh</code> 是舊的建構入口。</p>
                    <pre><code class="language-bash"># 推薦方式
make -C apps/ipro_ble_remote

# 舊方式（仍可使用）
./build_freertos.sh ipro_ble_remote build

# 清除編譯
make -C apps/ipro_ble_remote clean</code></pre>
                    <p>建構產出位於 <code>apps/&lt;project&gt;/build/build_out/</code>，二進位檔名包含晶片後綴（如 <code>ipro_ble_remote_IPRO7.bin</code>）。</p>
                </div>
            </div>

            <div class="faq-item" data-category="build">
                <div class="faq-question">
                    <span class="faq-badge build">Build</span>
                    <h3>.config 檔案格式是什麼？如何設定 CONFIG_* 變數？</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p><code>.config</code> 使用 Linux Kernel Kconfig 格式。每個應用程式都有自己的 <code>.config</code>，建構時會自動生成 <code>generated/autoconf.h</code>。</p>
                    <pre><code class="language-bash"># 基本格式
CONFIG_IPRO7=y                          # 布林值：啟用
CONFIG_CPU_ID="intelpro_ipro7"          # 字串值
CONFIG_FREERTOS_SUPPORT=y               # RTOS 選擇
CONFIG_BLUETOOTH_LE_ENABLE=y            # BLE 啟用
# CONFIG_LWIP is not set                # 布林值：停用</code></pre>
                    <p>修改 <code>.config</code> 後需要重新建構。常用的 CONFIG 變數包括 SoC 選擇（<code>CONFIG_IPRO7</code>）、RTOS（<code>CONFIG_FREERTOS_SUPPORT</code>）和元件啟用（<code>CONFIG_BLUETOOTH_LE_ENABLE</code>、<code>CONFIG_LWIP</code>、<code>CONFIG_MBEDTLS</code> 等）。</p>
                </div>
            </div>

            <div class="faq-item" data-category="build">
                <div class="faq-question">
                    <span class="faq-badge build">Build</span>
                    <h3>編譯時出現 "toolchain not found" 錯誤怎麼辦？</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>請確認 RISC-V 工具鏈已正確安裝並設定路徑：</p>
                    <pre><code class="language-bash"># 檢查工具鏈路徑
ls /opt/toolchain/riscv_ipro7/bin/

# 如果不存在，請設定正確的 CROSS_COMPILE 路徑
export CROSS_COMPILE=/your/toolchain/path/bin/riscv64-unknown-elf-

# 或在編譯指令中指定
cmake -DCROSS_COMPILE=/opt/toolchain/riscv_ipro7/bin/riscv64-unknown-elf- ...</code></pre>
                    <p>確保 <code>.config</code> 中的 <code>CONFIG_CPU_ID</code> 已正確設定，否則工具鏈無法偵測架構旗標。</p>
                </div>
            </div>

            <div class="faq-item" data-category="build">
                <div class="faq-question">
                    <span class="faq-badge build">Build</span>
                    <h3>編譯時 Flash 或 RAM 空間不足？</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>可以透過以下方式優化：</p>
                    <ol>
                        <li>在 <code>.config</code> 中關閉不需要的功能</li>
                        <li>使用 <code>-Os</code> 優化等級</li>
                        <li>檢查是否有未使用的組件被編譯進去</li>
                    </ol>
                    <pre><code class="language-bash"># 查看各模組大小
riscv64-unknown-elf-size build/build_out/*.elf

# 詳細分析
riscv64-unknown-elf-nm --size-sort build/build_out/*.elf | tail -50</code></pre>
                </div>
            </div>

            <!-- BLE Category -->
            <div class="faq-item" data-category="ble">
                <div class="faq-question">
                    <span class="faq-badge ble">BLE</span>
                    <h3>BLE Controller 的 linkN 變體該如何選擇？</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>根據應用需求選擇合適的 Controller 變體：</p>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr><th>變體</th><th>連線數</th><th>說明</th><th>適用場景</th></tr>
                            </thead>
                            <tbody>
                                <tr><td><code>link1_periph</code></td><td>1</td><td>僅 Peripheral</td><td>最小 footprint 的簡單周邊裝置</td></tr>
                                <tr><td><code>link1</code></td><td>1</td><td>Central + Peripheral</td><td>單一連線應用</td></tr>
                                <tr><td><code>link2</code></td><td>2</td><td>Central + Peripheral</td><td>常見應用（推薦預設）</td></tr>
                                <tr><td><code>link4</code></td><td>4</td><td>多連線</td><td>閘道器、多裝置管理</td></tr>
                                <tr><td><code>link8</code></td><td>8</td><td>多連線</td><td>大型多連線場景</td></tr>
                                <tr><td><code>link1_leaudio</code></td><td>1</td><td>BLE 5.2 + LE Audio</td><td>簡單 LE Audio 耳機</td></tr>
                                <tr><td><code>link2_leaudio</code></td><td>2</td><td>BLE 5.2 + LE Audio</td><td>TWS 耳機</td></tr>
                                <tr><td><code>link1_leaudio_53_54</code></td><td>1</td><td>BLE 5.4 + LE Audio</td><td>最新 LE Audio 功能</td></tr>
                                <tr><td><code>link2_leaudio_53_54</code></td><td>2</td><td>BLE 5.4 + LE Audio</td><td>最新 TWS 功能</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <p>連線模型採用統一連線池，任何連線都可以是 Central 或 Peripheral 角色，可自由組合。</p>
                </div>
            </div>

            <div class="faq-item" data-category="ble">
                <div class="faq-question">
                    <span class="faq-badge ble">BLE</span>
                    <h3>預編譯 Controller 函式庫如何使用？什麼是 build_all_prebuilts.sh？</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>BLE Controller 以預編譯靜態函式庫（<code>.a</code>）形式提供，位於 <code>components/wireless/bluetooth/btblecontroller/</code>。</p>
                    <p>若需要重建預編譯函式庫（例如更新 Controller 設定後），使用 <code>build_all_prebuilts.sh</code>：</p>
                    <pre><code class="language-bash"># 重建特定變體
components/wireless/bluetooth/build_all_prebuilts.sh link2

# 重建所有變體
components/wireless/bluetooth/build_all_prebuilts.sh all</code></pre>
                    <p>腳本會自動使用範本應用（base 用 <code>ipro_ble_remote</code>，LE Audio 用 <code>ipro_le_audio_headset</code>），編譯後自動剝離除錯資訊並寫入版本中繼資料。</p>
                    <div class="warning-box">
                        <h4>注意</h4>
                        <p><code>CONFIG_BLE_FORCE_SOURCE_BUILD</code> 不能用於發行版本。發行版本必須使用預編譯函式庫。</p>
                    </div>
                </div>
            </div>

            <div class="faq-item" data-category="ble">
                <div class="faq-question">
                    <span class="faq-badge ble">BLE</span>
                    <h3>多連線如何實現不同角色組合？</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>IPRO SDK 使用統一連線池模型。以 <code>link4</code> 為例，4 個連線可以是任意 Central/Peripheral 組合：</p>
                    <ul>
                        <li>4 個 Peripheral（被動連線）</li>
                        <li>4 個 Central（主動連線）</li>
                        <li>2 Central + 2 Peripheral（混合）</li>
                        <li>任何其他組合，只要總數不超過連線上限</li>
                    </ul>
                    <p>同一裝置可以同時廣播和掃描，實現 Relay、Mesh-like 拓撲等進階場景。</p>
                </div>
            </div>

            <div class="faq-item" data-category="ble">
                <div class="faq-question">
                    <span class="faq-badge ble">BLE</span>
                    <h3>手機搜尋不到 BLE 裝置？</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>請檢查以下項目：</p>
                    <ol>
                        <li>確認 Advertising 已啟動</li>
                        <li>檢查 Advertising Data 是否正確設定</li>
                        <li>確認包含正確的 Service UUID</li>
                        <li>檢查 RF 是否正常工作</li>
                    </ol>
                    <pre><code class="language-c">// 確保 Advertising Data 包含必要資訊
static const struct bt_data ad[] = {
    BT_DATA_BYTES(BT_DATA_FLAGS,
                  BT_LE_AD_GENERAL | BT_LE_AD_NO_BREDR),
    BT_DATA_BYTES(BT_DATA_NAME_COMPLETE, 'I','P','R','O'),
};

bt_le_adv_start(BT_LE_ADV_CONN, ad, ARRAY_SIZE(ad),
                NULL, 0);</code></pre>
                </div>
            </div>

            <div class="faq-item" data-category="ble">
                <div class="faq-question">
                    <span class="faq-badge ble">BLE</span>
                    <h3>LE Audio 音訊有雜音或斷斷續續？</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>音訊品質問題可能來源：</p>
                    <ul>
                        <li>ISO Interval 設定不當</li>
                        <li>LC3 編碼參數不匹配</li>
                        <li>Buffer underrun/overrun</li>
                        <li>RF 干擾或訊號弱</li>
                    </ul>
                    <pre><code class="language-c">// 建議的 LE Audio 參數
// 48kHz, 10ms frame duration
// SDU size: 120 bytes (48_4 config)
struct bap_unicast_config {
    .sampling_freq = 48000,
    .frame_duration = 10000,  // 10ms in us
    .octets_per_frame = 120,
};</code></pre>
                </div>
            </div>

            <!-- Debug / Serial Category -->
            <div class="faq-item" data-category="debug">
                <div class="faq-question">
                    <span class="faq-badge debug">Debug</span>
                    <h3>macOS 上序列埠 cu.* 和 tty.* 有什麼區別？</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>在 macOS 上，每個序列裝置都有兩個裝置節點：</p>
                    <ul>
                        <li><code>/dev/cu.*</code> (Calling Unit) - <strong>必須使用此裝置</strong>。不等待 DCD 信號，可直接開啟。</li>
                        <li><code>/dev/tty.*</code> (Teletype) - 會等待 DCD 信號，導致程式掛起無法使用。</li>
                    </ul>
                    <pre><code class="language-bash"># 正確做法
python3 tools/serial_monitor.py /dev/cu.usbserial-2120

# 錯誤做法（會掛住）
python3 tools/serial_monitor.py /dev/tty.usbserial-2120</code></pre>
                </div>
            </div>

            <div class="faq-item" data-category="debug">
                <div class="faq-question">
                    <span class="faq-badge debug">Debug</span>
                    <h3>序列埠出現 "Resource busy" 錯誤怎麼辦？</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>這通常是因為其他程式（包括 <code>stty</code>）正在占用序列埠。解決方法：</p>
                    <ol>
                        <li>檢查並關閉占用埠的程式：<code>lsof /dev/cu.usbserial-2120</code></li>
                        <li>避免使用 <code>stty -f</code>，它會保持埠忙碌</li>
                        <li>使用 <code>tools/serial_monitor.py</code> 取代 <code>cat</code> 或 <code>screen</code></li>
                    </ol>
                    <p><code>serial_monitor.py</code> 使用 Python3 termios，以 <code>O_NOCTTY | O_NONBLOCK</code> 旗標開啟埠，不需要 pyserial 依賴。</p>
                </div>
            </div>

            <div class="faq-item" data-category="debug">
                <div class="faq-question">
                    <span class="faq-badge debug">Debug</span>
                    <h3>如何啟用 Debug Log？</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>在 <code>.config</code> 中設定：</p>
                    <pre><code class="language-bash"># 啟用 Debug 模式
CONFIG_CFG_DBG=y

# 啟用 BLE Library Debug
CONFIG_IPRO_BLE_LIB_DEBUG_ENABLE=y

# 設定 Log Level
CONFIG_LOG_DEFAULT_LEVEL=4  # DEBUG</code></pre>
                </div>
            </div>

            <div class="faq-item" data-category="debug">
                <div class="faq-question">
                    <span class="faq-badge debug">Debug</span>
                    <h3>遇到 Hard Fault 如何分析？</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>Hard Fault 通常由以下原因造成：</p>
                    <ul>
                        <li>空指標存取</li>
                        <li>Stack overflow</li>
                        <li>非對齊記憶體存取</li>
                        <li>非法指令</li>
                    </ul>
                    <pre><code class="language-bash"># 使用 addr2line 解析 backtrace
riscv64-unknown-elf-addr2line -e build/build_out/app.elf 0x12345678</code></pre>
                </div>
            </div>

            <!-- RF Category -->
            <div class="faq-item" data-category="rf">
                <div class="faq-question">
                    <span class="faq-badge rf">RF</span>
                    <h3>CFO (載波頻率偏移) 過大怎麼調整？</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>CFO 問題通常有兩個原因：</p>
                    <ol>
                        <li><strong>rf_kcal 未執行：</strong> 檢查 RF_CAL_STATE_CTRL 寄存器</li>
                        <li><strong>XTAL 頻率偏差：</strong> 調整 capcode</li>
                    </ol>
                    <pre><code class="language-c">// 調整 XTAL capcode
// CFO 為負值（頻率太低）: 降低 capcode
// CFO 為正值（頻率太高）: 提高 capcode
tmpVal = BL_RD_REG(AON_BASE, AON_XTAL_CFG2);
tmpVal = BL_SET_REG_BITS_VAL(tmpVal, AON_XTAL_HF_CAPCODE_IN_AON, 70);
tmpVal = BL_SET_REG_BITS_VAL(tmpVal, AON_XTAL_HF_CAPCODE_OUT_AON, 70);
BL_WR_REG(AON_BASE, AON_XTAL_CFG2, tmpVal);</code></pre>
                </div>
            </div>

            <div class="faq-item" data-category="rf">
                <div class="faq-question">
                    <span class="faq-badge rf">RF</span>
                    <h3>TX Power 如何設定？</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>IPRO7 支援的 TX Power 範圍為 -20dBm ~ +10dBm：</p>
                    <pre><code class="language-c">// Power Level 對照表
// 0: -20dBm    4: -10dBm
// 8: 0dBm     12: +5dBm    15: +10dBm

// CLI 設定
// rf_set_pwr &lt;power_level&gt;

// 程式碼設定
rf_set_tx_power(power_level);</code></pre>
                </div>
            </div>

            <!-- RTOS Category -->
            <div class="faq-item" data-category="rtos">
                <div class="faq-question">
                    <span class="faq-badge rtos">RTOS</span>
                    <h3>FreeRTOS vs Zephyr 該選哪個？</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>特性</th>
                                <th>FreeRTOS</th>
                                <th>Zephyr</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>學習曲線</td><td>較低</td><td>較高</td></tr>
                            <tr><td>BLE 支援</td><td>完整（生產就緒）</td><td>實驗性</td></tr>
                            <tr><td>記憶體佔用</td><td>較小</td><td>較大</td></tr>
                            <tr><td>設備驅動</td><td>手動整合</td><td>Device Tree</td></tr>
                            <tr><td>建構時間</td><td>較長</td><td>約 30 秒</td></tr>
                        </tbody>
                    </table>
                    <p><strong>建議：</strong>BLE 應用和生產產品選 FreeRTOS。Zephyr 目前為實驗性支援，適合需要 Device Tree 和現代化開發體驗的場景，但不建議用於生產環境。</p>
                    <pre><code class="language-bash"># FreeRTOS 建構（推薦）
make -C apps/ipro_ble_remote

# Zephyr 建構（實驗性）
./tools/zephyr/build.sh -a &lt;app&gt; -b ipro7_fpga -c</code></pre>
                </div>
            </div>

            <div class="faq-item" data-category="rtos">
                <div class="faq-question">
                    <span class="faq-badge rtos">RTOS</span>
                    <h3>Task Stack Overflow 如何解決？</h3>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div class="faq-answer">
                    <p>增加 Task 的 Stack 大小：</p>
                    <pre><code class="language-c">// FreeRTOS
xTaskCreate(
    task_function,
    "TaskName",
    2048,  // 增加 Stack 大小 (words)
    NULL,
    tskIDLE_PRIORITY + 1,
    &task_handle
);</code></pre>
                    <p>也可以啟用 Stack 監控功能來追蹤使用量。</p>
                </div>
            </div>

        </div>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // FAQ Accordion
    const faqItems = document.querySelectorAll('.faq-item');
    faqItems.forEach(item => {
        const question = item.querySelector('.faq-question');
        question.addEventListener('click', () => {
            item.classList.toggle('open');
        });
    });

    // Category Filter
    const categoryBtns = document.querySelectorAll('.faq-category-btn');
    categoryBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            categoryBtns.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            const category = btn.dataset.category;
            faqItems.forEach(item => {
                if (category === 'all' || item.dataset.category === category) {
                    item.classList.remove('hidden');
                } else {
                    item.classList.add('hidden');
                }
            });
        });
    });

    // Search
    const searchInput = document.getElementById('faq-search-input');
    searchInput.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase();
        faqItems.forEach(item => {
            const text = item.textContent.toLowerCase();
            if (text.includes(query)) {
                item.classList.remove('hidden');
            } else {
                item.classList.add('hidden');
            }
        });

        // Reset category filter
        categoryBtns.forEach(b => b.classList.remove('active'));
        document.querySelector('[data-category="all"]').classList.add('active');
    });
});
</script>
