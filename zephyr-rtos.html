---
layout: default
title: Zephyr RTOS
---

<div class="doc-layout">
    <aside class="doc-sidebar">
        <nav class="sidebar-nav">
            <h4 class="sidebar-title">æœ¬é ç›®éŒ„</h4>
            <ul class="sidebar-links">
                <li><a href="#overview" class="sidebar-link">æ¦‚è¦½</a></li>
                <li><a href="#architecture" class="sidebar-link">æ•´åˆæ¶æ§‹</a></li>
                <li><a href="#setup" class="sidebar-link">ç’°å¢ƒè¨­ç½®</a></li>
                <li><a href="#building" class="sidebar-link">å»ºæ§‹æ‡‰ç”¨</a></li>
                <li><a href="#tools" class="sidebar-link">é–‹ç™¼å·¥å…·</a></li>
                <li><a href="#device-tree" class="sidebar-link">Device Tree</a></li>
                <li><a href="#creating-apps" class="sidebar-link">å»ºç«‹æ–°æ‡‰ç”¨</a></li>
                <li><a href="#debugging" class="sidebar-link">é™¤éŒ¯</a></li>
            </ul>
        </nav>
    </aside>

    <article class="doc-content">
        <h1>Zephyr RTOS æ•´åˆæŒ‡å—</h1>
        <p>Zephyr æ˜¯ä¸€å€‹å¯æ“´å±•çš„é–‹æºå³æ™‚ä½œæ¥­ç³»çµ±ï¼Œå°ˆç‚ºè³‡æºå—é™çš„è£ç½®è¨­è¨ˆã€‚IPRO SDK æä¾›å®Œæ•´çš„ Zephyr æ”¯æ´ï¼Œä½œç‚º FreeRTOS çš„ç¾ä»£åŒ–æ›¿ä»£æ–¹æ¡ˆã€‚</p>

        <section id="overview">
            <h2>ç‚ºä»€éº¼é¸æ“‡ Zephyrï¼Ÿ</h2>

            <div class="features-grid" style="margin: 2rem 0;">
                <div class="feature-card">
                    <div class="feature-icon">âš¡</div>
                    <h3 class="feature-title">å¿«é€Ÿå»ºæ§‹</h3>
                    <p class="feature-description">å„ªåŒ–å¾Œçš„æ¨¡çµ„ä¸‹è¼‰åƒ…éœ€ç´„ 125MBï¼Œå»ºæ§‹æ™‚é–“ç´„ 30 ç§’ã€‚</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ¯</div>
                    <h3 class="feature-title">è¨˜æ†¶é«”æ•ˆç‡</h3>
                    <p class="feature-description">Demo æ‡‰ç”¨åƒ…éœ€ 33KB ROMã€27KB RAMï¼Œé«˜åº¦å„ªåŒ–çš„è³‡æºä½¿ç”¨ã€‚</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">ğŸ”§</div>
                    <h3 class="feature-title">ç¾ä»£å·¥å…·éˆ</h3>
                    <p class="feature-description">West å»ºæ§‹ç³»çµ±ã€Device Tree é…ç½®ã€è±å¯Œçš„é©…å‹•ç”Ÿæ…‹ã€‚</p>
                </div>
            </div>

            <h3>ä¸»è¦å„ªå‹¢</h3>
            <ul>
                <li><strong>Device Tree</strong>ï¼šå®£å‘Šå¼ç¡¬é«”é…ç½®ï¼Œæ˜“æ–¼ç§»æ¤</li>
                <li><strong>Kconfig</strong>ï¼šåœ–å½¢åŒ–é…ç½®ä»‹é¢</li>
                <li><strong>West</strong>ï¼šçµ±ä¸€çš„å°ˆæ¡ˆç®¡ç†èˆ‡å»ºæ§‹å·¥å…·</li>
                <li><strong>è±å¯Œç”Ÿæ…‹</strong>ï¼šå¤§é‡ç¾æˆçš„é©…å‹•èˆ‡å”å®šæ£§</li>
                <li><strong>æ´»èºç¤¾ç¾¤</strong>ï¼šæŒçºŒæ›´æ–°èˆ‡æŠ€è¡“æ”¯æ´</li>
            </ul>
        </section>

        <section id="architecture">
            <h2>æ•´åˆæ¶æ§‹</h2>
            <p>IPRO SDK æä¾›å°ˆç”¨çš„ HAL å±¤ï¼Œè®“ Zephyr èƒ½å¤ åœ¨ IPRO ç¡¬é«”ä¸Šé«˜æ•ˆé‹è¡Œã€‚</p>

            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">Zephyr æ•´åˆæ¶æ§‹</span>
                </div>
                <pre><code>+------------------------------------------------------+
|              Application Layer                       |
|         (apps/ipro_zephyr_demo)                      |
+------------------------------------------------------+
|       Middleware & Components                        |
|      (lwIP, MbedTLS, etc.)                           |
+------------------------------------------------------+
|           Zephyr RTOS Kernel                         |
+------------------------------------------------------+
|     IPRO-Zephyr Integration Layer                    |
|          (HAL & Drivers)                             |
+------------------------------------------------------+
|         IPRO Hardware Platform                       |
+------------------------------------------------------+</code></pre>
            </div>

            <h3>æ”¯æ´çš„é–‹ç™¼æ¿</h3>
            <ul>
                <li><code>ipro7</code> - IPRO7 SoC åŸºç¤é…ç½®</li>
                <li><code>ipro7_fpga</code> - FPGA é–‹ç™¼ç’°å¢ƒ</li>
                <li><code>ipro7_evb</code> - è©•ä¼°æ¿é…ç½®</li>
            </ul>
        </section>

        <section id="setup">
            <h2>ç’°å¢ƒè¨­ç½®</h2>

            <h3>ä¸€éµè¨­ç½®ï¼ˆæ¨è–¦ï¼‰</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">Bootstrap ç’°å¢ƒ</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash"># å¾ SDK æ ¹ç›®éŒ„åŸ·è¡Œ
./tools/zephyr/bootstrap.sh

# è…³æœ¬æœƒè‡ªå‹•å®Œæˆï¼š
# âœ“ ä¸‹è¼‰ä¸¦å®‰è£ Zephyr SDK
# âœ“ å®‰è£ west å»ºæ§‹å·¥å…·
# âœ“ è¨­ç½®ç’°å¢ƒè®Šæ•¸
# âœ“ ä¸‹è¼‰å¿…è¦çš„ Zephyr æ¨¡çµ„ï¼ˆ6 å€‹æ ¸å¿ƒæ¨¡çµ„ï¼Œç´„ 125MBï¼‰</code></pre>
            </div>

            <h3>æ‰‹å‹•è¨­ç½®</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">æ‰‹å‹•å®‰è£æ­¥é©Ÿ</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash"># 1. ä¸‹è¼‰ Zephyr SDK
wget https://github.com/zephyrproject-rtos/sdk-ng/releases/download/v0.16.3/zephyr-sdk-0.16.3_linux-x86_64.tar.xz
tar -xf zephyr-sdk-0.16.3_linux-x86_64.tar.xz
cd zephyr-sdk-0.16.3 && ./setup.sh

# 2. å®‰è£ west
pip3 install west

# 3. è¨­ç½®ç’°å¢ƒè®Šæ•¸
export ZEPHYR_BASE=/path/to/zephyrproject
export ZEPHYR_SDK_INSTALL_DIR=/path/to/zephyr-sdk

# 4. åˆå§‹åŒ– west workspace
cd ipro_sdk
west init -l .
west update</code></pre>
            </div>

            <div class="alert alert-info">
                <strong>ğŸ’¡ æç¤ºï¼š</strong>å»ºè­°ä½¿ç”¨ <code>bootstrap.sh</code> è…³æœ¬ï¼Œå®ƒæœƒè‡ªå‹•è™•ç†æ‰€æœ‰ç›¸ä¾æ€§ä¸¦å„ªåŒ–æ¨¡çµ„ä¸‹è¼‰ã€‚
            </div>
        </section>

        <section id="building">
            <h2>å»ºæ§‹æ‡‰ç”¨</h2>

            <h3>ä½¿ç”¨ build.sh è…³æœ¬</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">å¢å¼·å»ºæ§‹è…³æœ¬</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash"># åŸºæœ¬å»ºæ§‹
./tools/zephyr/build.sh -a ipro_zephyr_demo -b ipro7_fpga

# æ¸…é™¤ä¸¦é‡æ–°å»ºæ§‹
./tools/zephyr/build.sh -a ipro_zephyr_demo -b ipro7_fpga -c

# é¡¯ç¤ºè©³ç´°é€²åº¦
./tools/zephyr/build.sh -a ipro_zephyr_demo -b ipro7_fpga -v</code></pre>
            </div>

            <h3>ä½¿ç”¨ west æŒ‡ä»¤</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">West å»ºæ§‹æŒ‡ä»¤</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash"># é€²å…¥ workspace
cd zephyr-workspace
source setup_env.sh

# å»ºæ§‹æ‡‰ç”¨
west build -b ipro7_fpga ../apps/ipro_zephyr_demo

# æ¸…é™¤ä¸¦å»ºæ§‹
west build -b ipro7_fpga ../apps/ipro_zephyr_demo --pristine

# ç‡’éŒ„ï¼ˆéœ€é€£æ¥ç¡¬é«”ï¼‰
west flash

# é–‹å•Ÿåºåˆ—ç›£æ§
west espmonitor  # æˆ–ä½¿ç”¨å…¶ä»–åºåˆ—å·¥å…·</code></pre>
            </div>
        </section>

        <section id="tools">
            <h2>é–‹ç™¼å·¥å…·</h2>
            <p>SDK æä¾›å¤šå€‹å¯¦ç”¨å·¥å…·è…³æœ¬ï¼Œç°¡åŒ– Zephyr é–‹ç™¼æµç¨‹ã€‚</p>

            <h3>äº’å‹•å¼é¸å–® (menu.sh)</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">å•Ÿå‹•äº’å‹•å¼é¸å–®</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash"># æ”¯æ´ä¸­è‹±é›™èªä»‹é¢
./tools/zephyr/menu.sh</code></pre>
            </div>
            <p>é¸å–®æä¾›ï¼š</p>
            <ul>
                <li>ç’°å¢ƒè¨­ç½®èˆ‡åˆå§‹åŒ–</li>
                <li>æ‡‰ç”¨ç¨‹å¼ç€è¦½èˆ‡å»ºæ§‹</li>
                <li>Zephyr ç¯„ä¾‹æœå°‹</li>
                <li>é…ç½®ç®¡ç†</li>
            </ul>

            <h3>æ‡‰ç”¨ç®¡ç† (apps.sh)</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">æ‡‰ç”¨ç®¡ç†å·¥å…·</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash"># åˆ—å‡ºæ‰€æœ‰æ‡‰ç”¨
./tools/zephyr/apps.sh list

# æœå°‹æ‡‰ç”¨
./tools/zephyr/apps.sh search bluetooth

# åˆ—å‡º Zephyr ç¯„ä¾‹é¡åˆ¥
./tools/zephyr/apps.sh categories

# é¡¯ç¤ºæ‡‰ç”¨è©³ç´°è³‡è¨Š
./tools/zephyr/apps.sh info ipro_zephyr_demo</code></pre>
            </div>
        </section>

        <section id="device-tree">
            <h2>Device Tree é…ç½®</h2>
            <p>Zephyr ä½¿ç”¨ Device Tree æè¿°ç¡¬é«”é…ç½®ï¼Œè®“é©…å‹•èˆ‡ç¡¬é«”è§£è€¦ã€‚</p>

            <h3>Device Tree çµæ§‹</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">ipro7_fpga.dts ç¯„ä¾‹</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-dts">/dts-v1/;

/ {
    model = "IPRO7 FPGA";
    compatible = "ipro,ipro7-fpga";

    chosen {
        zephyr,console = &uart0;
        zephyr,shell-uart = &uart0;
        zephyr,sram = &sram0;
    };

    soc {
        uart0: uart@40000000 {
            compatible = "ipro,uart";
            reg = <0x40000000 0x1000>;
            interrupts = <10>;
            status = "okay";
        };

        gpio0: gpio@40001000 {
            compatible = "ipro,gpio";
            reg = <0x40001000 0x1000>;
            gpio-controller;
            #gpio-cells = <2>;
        };
    };
};</code></pre>
            </div>

            <h3>Overlay é…ç½®</h3>
            <p>å¯ä»¥ä½¿ç”¨ overlay æª”æ¡ˆè¦†è“‹é è¨­é…ç½®ï¼š</p>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">app.overlay</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-dts">/* è¦†è“‹ UART é…ç½® */
&uart0 {
    current-speed = <921600>;
};</code></pre>
            </div>
        </section>

        <section id="creating-apps">
            <h2>å»ºç«‹æ–°æ‡‰ç”¨</h2>

            <h3>1. å»ºç«‹ç›®éŒ„çµæ§‹</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">æ‡‰ç”¨ç›®éŒ„çµæ§‹</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash">mkdir -p apps/my_zephyr_app/src</code></pre>
            </div>

            <h3>2. å»ºç«‹ CMakeLists.txt</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">CMakeLists.txt</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-cmake">cmake_minimum_required(VERSION 3.20)
find_package(Zephyr REQUIRED HINTS $ENV{ZEPHYR_BASE})
project(my_zephyr_app)

target_sources(app PRIVATE
    src/main.c
)</code></pre>
            </div>

            <h3>3. å»ºç«‹ prj.conf</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">prj.conf</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash"># åŸºæœ¬é…ç½®
CONFIG_PRINTK=y
CONFIG_LOG=y

# GPIO æ”¯æ´
CONFIG_GPIO=y

# ä¸²å£æ”¯æ´
CONFIG_SERIAL=y
CONFIG_UART_CONSOLE=y</code></pre>
            </div>

            <h3>4. å»ºç«‹ä¸»ç¨‹å¼</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">src/main.c</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-c">#include &lt;zephyr/kernel.h&gt;
#include &lt;zephyr/logging/log.h&gt;

LOG_MODULE_REGISTER(my_app, LOG_LEVEL_INF);

int main(void)
{
    LOG_INF("My Zephyr App Started!");
    
    while (1) {
        LOG_INF("Hello from Zephyr!");
        k_sleep(K_SECONDS(1));
    }
    
    return 0;
}</code></pre>
            </div>

            <h3>5. å»ºæ§‹ä¸¦åŸ·è¡Œ</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">å»ºæ§‹æ–°æ‡‰ç”¨</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash">./tools/zephyr/build.sh -a my_zephyr_app -b ipro7_fpga</code></pre>
            </div>
        </section>

        <section id="debugging">
            <h2>é™¤éŒ¯</h2>

            <h3>ä½¿ç”¨ west debug</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">West é™¤éŒ¯æŒ‡ä»¤</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash"># å•Ÿå‹• GDB é™¤éŒ¯
west debug

# åƒ…å•Ÿå‹• debug server
west debugserver</code></pre>
            </div>

            <h3>æ—¥èªŒé…ç½®</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">prj.conf æ—¥èªŒè¨­å®š</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash"># å•Ÿç”¨æ—¥èªŒ
CONFIG_LOG=y
CONFIG_LOG_DEFAULT_LEVEL=4  # DEBUG

# å¾Œç«¯é…ç½®
CONFIG_LOG_BACKEND_UART=y
CONFIG_LOG_BUFFER_SIZE=4096</code></pre>
            </div>

            <h3>Shell æ”¯æ´</h3>
            <div class="code-block">
                <div class="code-block-header">
                    <span class="code-block-title">å•Ÿç”¨ Shell</span>
                    <button class="code-copy-btn"><i class="fas fa-copy"></i></button>
                </div>
                <pre><code class="language-bash"># prj.conf
CONFIG_SHELL=y
CONFIG_SHELL_BACKEND_SERIAL=y

# å…§å»ºæŒ‡ä»¤
CONFIG_KERNEL_SHELL=y
CONFIG_DEVICE_SHELL=y</code></pre>
            </div>
        </section>
    </article>
</div>